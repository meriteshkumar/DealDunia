@model DealDunia.Web.Areas.Coupon

<div class="modal-content">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Add/Edit Coupon</h4>
    </div>
    @using (Html.BeginForm("", "", FormMethod.Post, new { enctype = "multipart/form-data", id = "myForm" }))
    { 
        @Html.ValidationSummary();
        <div class="modal-body">
            <div class="form-horizontal">
                @Html.HiddenFor(h => h.CouponId)
                <input type="hidden" id="hdStore" name="StoreName" />
                <div class="form-group">
                    <label for="StoreSource" class="col-md-2">Source</label>
                    <div class="col-md-3 divStoreSourceID">
                        <!-- placeholder for store source dropdown -->
                    </div>
                    <label for="OfferId" class="col-md-2">Offer ID</label>
                    <div class="col-md-5 divStoreID">
                        <!-- placeholder for store dropdown -->
                    </div>
                </div>
                <div class="form-group">
                    <label for="PromoId" class="col-md-2">Promo ID</label>
                    <div class="col-md-3">
                        @Html.TextBoxFor(t => t.PromoId, new { @class = "form-control" })
                    </div>
                    <label for="OfferName" class="col-md-2">Offer Name</label>
                    <div class="col-md-5">
                        @Html.TextBoxFor(t => t.OfferName, new { @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    <label for="CouponTitle" class="col-md-2">Title</label>
                    <div class="col-md-10">
                        @Html.TextBoxFor(t => t.CouponTitle, new { @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    <label for="Description" class="col-md-2">Description</label>
                    <div class="col-md-10">
                        @Html.TextAreaFor(t => t.Description, new { cols = "40", rows = "2", @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    <label for="OfferType" class="col-md-2">Type</label>
                    <div class="col-md-3">
                        @Html.DropDownList("OfferType", new SelectList(new SelectListItem[]{ 
                                    new SelectListItem { Value = "Coupon", Text= "Coupon" }, 
                                    new SelectListItem { Value = "Deal", Text= "Deal"} 
                   }, "Value", "Text"), "Please select", new { @class = "form-control" })
                    </div>
                    <label for="CouponCode" class="col-md-2">Code</label>
                    <div class="col-md-5">
                        @Html.TextBoxFor(t => t.CouponCode, new { @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    <label for="Category" class="col-md-2">Category</label>
                    <div class="col-md-3">
                        @Html.TextBoxFor(t => t.Category, new { @class = "form-control" })
                    </div>
                    <label for="StoreCategory" class="col-md-2">Store Category</label>
                    <div class="col-md-5 divStoreCategoryID">
                        <!-- placeholder for store category dropdown -->
                    </div>
                </div>
                <div class="form-group">
                    <label for="OfferURL" class="col-md-2">Offer URL</label>
                    <div class="col-md-10">
                        @Html.TextBoxFor(t => t.OfferURL, new { @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    <label for="CouponStart" class="col-md-2">St. Date</label>
                    <div class="col-md-4">
                        @Html.TextBoxFor(t => t.CouponStart, new { @class = "form-control startdate" })
                    </div>
                    <label for="CouponExpiry" class="col-md-2">Expiry</label>
                    <div class="col-md-4">
                        @Html.TextBoxFor(t => t.CouponExpiry, new { @class = "form-control enddate" })
                    </div>
                </div>
                <div class="form-group">
                    <label for="Featured" class="col-md-2">Featured</label>
                    <div class="col-md-2">
                        @Html.EditorFor(m => m.Featured)
                    </div>
                    <label for="Exclusive" class="col-md-2">Exclusive</label>
                    <div class="col-md-2">
                        @Html.EditorFor(m => m.Exclusive)
                    </div>
                    <label for="Status" class="col-md-2">Status</label>
                    <div class="col-md-2">
                        @Html.EditorFor(m => m.Status)
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <input type="submit" value="Save changes" class="btn btn-primary" />
            </div>
        </div>
    }
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var settings = {
            storeSourceDropDown: '@Url.Action("_StoreSourceDropDown", "Coupons")',
            storeURL: '@Url.Action("GetStoreByStoreSource", "Coupons")',
            couponStoreCategoryURL: '@Url.Action("_CouponStoreCategory", "Coupons")'
        };

        callAjaxURLWithSingleParam(settings.storeSourceDropDown, { controlName: "StoreSourceId" })
        .done(function (data) {
            $(".divStoreSourceID").html(data);
        }).fail(function (error) {
            //TODO:Debugging
        });

        $(document).on("change", ".divStoreSourceID #ss-dropdown", function () {
            $(".divStoreID").html('');

            var storeSourceId = $(".divStoreSourceID #ss-dropdown option:selected").first().val();

            callAjaxPostURLWithSingleParamJSON(settings.storeURL, { StoreSourceId: storeSourceId })
            .done(function (data) {
                var html = "<select class='form-control' id='OfferId' name='OfferId'>";
                $.each(data, function (index, value) {
                    html += '<option value="' + value.SourceStoreId + '">' + value.StoreName + '</option>';
                });
                html += "</select>";
                $(".divStoreID").html(html);
            }).fail(function (error) {
                //TODO:Debugging
            });
        });

        $(document).on("change", ".divStoreID #OfferId", function () {
            var storeSourceId = $(".divStoreSourceID #ss-dropdown option:selected").first().val();
            var sourceStoreId = $(".divStoreID #OfferId option:selected").first().val();

            callAjaxPostURLWithSingleParamJSON(settings.couponStoreCategoryURL, { StoreSourceId: storeSourceId, SourceStoreId: sourceStoreId })
            .done(function (categories) {
                var html = "";
                $.each(categories, function (index, value) {
                    html += '<input type="checkbox" value="' + value.StoreCategoryId + '"></input>&nbsp;' + '<span>' + value.StoreCategoryName + '</span>&nbsp;';
                });
                $(".divStoreCategoryID").html(html);
            })
            .fail(function (data, status, headers, config) {
                //TODO:Debugging
            });
        });
    });
</script>
